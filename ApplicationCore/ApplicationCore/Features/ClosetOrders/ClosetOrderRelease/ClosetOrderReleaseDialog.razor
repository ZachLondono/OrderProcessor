@using ApplicationCore.Features.ClosetOrders.ClosetOrderSelector
@using ApplicationCore.Features.GetJobCutListDirectory
@using Domain.Components
@using Domain.Components.ProgressModal
@using Domain.Infrastructure.Bus
@using Domain.Services

@if (_errorMessage is not null) {
    <span class="font-semibold text-red-600">@_errorMessage</span>
}

@if (IsLoading) {

    <div class="text-center mb-4 font-bold text-blue-700">Loading...</div>
    <svg class="animate-spin mx-auto h-12 w-12 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-10" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>

} else {
    
    <EditForm Model="Model">

        <div>
            <label class="font-semibold">Workbook -</label>
            <span class="ml-5">@Model.WorkbookFilePath</span>

            <div class="ml-5 text-sm text-gray-700">
                <div>
                    <label>
                        <InputCheckbox @bind-Value="Model.IncludeCover" />
                        Cover
                    </label>
                </div>
                <div>
                    <label>
                        <InputCheckbox @bind-Value="Model.IncludePackingList" />
                        Packing List
                    </label>
                </div>
                <div>
                    <label>
                        <InputCheckbox @bind-Value="Model.IncludePartList" />
                        Part List
                    </label>
                </div>
                <div>
                    <label>
                        <InputCheckbox @bind-Value="Model.IncludeDBList" />
                        Dovetail List
                    </label>
                </div>
                <div>
                    <label>
                        <InputCheckbox @bind-Value="Model.IncludeMDFList" />
                        MDF List
                    </label>
                </div>
                <div>
                    <label>
                        <InputCheckbox @bind-Value="Model.IncludeOthersList" />
                        Counters / Others
                    </label>
                </div>
                <div>
                    <label>
                        <InputCheckbox @bind-Value="Model.IncludeSummary" />
                        Summary
                    </label>
                </div>
            </div>
        </div>

        <div class="mt-3">
            <label>
                <InputCheckbox @bind-Value="Model.AddExistingWSXMLReport" />
                <span class="text-gray-700">Existing GCode (WSXML)</span>
            </label>
            @if (Model.AddExistingWSXMLReport) {
                <div>
                    <Button Color="Button.ButtonColor.Secondary" OnClick="ChooseReportFile" Class="mr-5">Choose Report</Button>
                    @if (string.IsNullOrEmpty(Model.WSXMLReportFilePath)) {
                        <span>None selected</span>
                    } else {
                        <span>@Model.WSXMLReportFilePath</span>
                    }
                </div>
            }
        </div>

        <div class="mt-3">
            <label>
                <span class="text-gray-700">
                    File Name
                </span>
                <InputText @bind-Value="Model.FileName" class="input-text w-full" spellcheck="false" />
            </label>
        </div>

        <div class="mt-3">
            <label>
                <span class="text-gray-700">
                    Output Directory
                </span>
                <InputText @bind-Value="Model.OutputDirectory" class="input-text w-full" spellcheck="false" />
            </label>
        </div>

        <div class="mt-3">
            <label class="font-semibold">
                <InputCheckbox @bind-Value="Model.SendEmail" />
                <span class="text-gray-700">Send Release Email</span>
            </label>
            @if (Model.SendEmail) {
                <div class="ml-3">
                    <div>
                        <label>
                            <InputCheckbox @bind-Value="Model.PreviewEmail" />
                            <span class="text-gray-700 text-sm">Preview email before sending</span>
                        </label>
                    </div>
                    <label>
                        <span class="text-sm font-medium text-gray-700">Email Recipients</span>
                        <InputText @bind-Value="Model.EmailRecipients" class="input-text w-full" placeholder="example@email.com" />
                    </label>
                </div>
            }
        </div>

        <div class="mt-5">
            <hr />
        </div>

        <div class="mt-5">

            <span class="font-semibold">Invoice</span>

            <div class="text-gray-700 mt-3">
                <div>
                    <label>
                        <InputCheckbox @bind-Value="Model.InvoicePDF" />
                        Invoice PDF
                    </label>
                </div>
            </div>

            @if (Model.InvoicePDF) {
                <div class="mt-3">
                    <label>
                        <span class="text-gray-700">
                            Invoice Output Directory
                        </span>
                        <InputText @bind-Value="Model.InvoiceDirectory" class="input-text w-full" spellcheck="false" />
                    </label>
                </div>

                <div class="mt-3">
                    <label>
                        <InputCheckbox @bind-Value="Model.SendInvoiceEmail" />
                        <span class="text-gray-700">Invoice Email</span>
                    </label>
                </div>

                @if (Model.SendInvoiceEmail) {
                    <div class="ml-3">
                        <div>
                            <label>
                                <InputCheckbox @bind-Value="Model.PreviewInvoiceEmail" />
                                <span class="text-gray-700 text-sm">Preview email before sending</span>
                            </label>
                        </div>
                        <label>
                            <span class="text-sm font-medium text-gray-700">Email Recipients</span>
                            <InputText @bind-Value="Model.InvoiceEmailRecipients" class="input-text w-full" placeholder="example@email.com" />
                        </label>
                    </div>
                }
            }

        </div>

        <div class="mt-5">
            <hr />
        </div>

        <div class="mt-5">

            <span class="font-semibold">Confirmation</span>

            <div class="mt-3">
                <label>
                    <InputCheckbox @bind-Value="Model.SendAcknowledgementEmail" />
                    <span class="text-gray-700">Send Acknowlegment Email</span>
                </label>
            </div>

            @if (Model.SendAcknowledgementEmail) {
                <div class="ml-3">
                    <div>
                        <label>
                            <InputCheckbox @bind-Value="Model.PreviewAcknowledgementEmail" />
                            <span class="text-gray-700 text-sm">Preview email before sending</span>
                        </label>
                    </div>
                    <label>
                        <span class="text-sm font-medium text-gray-700">Email Recipients</span>
                        <InputText @bind-Value="Model.AcknowledgmentEmailRecipients" class="input-text w-full" placeholder="example@email.com" />
                    </label>
                </div>
            }

        </div>

        <div class="mt-5">
            <hr />
        </div>

        <div class="mt-5">

            <span class="font-semibold">Dovetail DB</span>

            <div class="mt-3">
                <label>
                    <InputCheckbox @bind-Value="Model.SendDovetailReleaseEmail" />
                    <span class="text-gray-700">Send Dovetail DB Release Email</span>
                </label>
            </div>

            @if (Model.SendDovetailReleaseEmail) {
                <div class="ml-3">
                    <div>
                        <label>
                            <InputCheckbox @bind-Value="Model.PreviewDovetailReleaseEmail" />
                            <span class="text-gray-700 text-sm">Preview email before sending</span>
                        </label>
                    </div>
                    <label>
                        <span class="text-sm font-medium text-gray-700">Email Recipients</span>
                        <InputText @bind-Value="Model.DovetailReleaseEmailRecipients" class="input-text w-full" placeholder="example@email.com" />
                    </label>
                </div>
            }

        </div>

        <div class="my-5">
            <hr />
        </div>

        <div class="my-5 text-center">
            <Button Color="Button.ButtonColor.Primary" class="mt-3" OnClickAsync="GenerateClosetOrderRelease">Release</Button>
        </div>

    </EditForm>

}
