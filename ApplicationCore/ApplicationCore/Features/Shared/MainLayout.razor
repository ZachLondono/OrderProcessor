@using ApplicationCore.Features.CNC.ReleasePDF;
@using ApplicationCore.Features.Companies.Create
@using ApplicationCore.Features.Orders
@using ApplicationCore.Features.Orders.Loader
@using ApplicationCore.Features.CNC.LabelDB
@using ApplicationCore.Features.Orders.Loader.Dialog;
@using ApplicationCore.Features.Orders.Shared.State;
@using ApplicationCore.Features.Shared.Services;
@using ApplicationCore.Features.WorkOrders;
@using ApplicationCore.Infrastructure
@using System.Diagnostics;
@using static ApplicationCore.Features.Shared.InformationDialog;
@using ApplicationCore.Features.CNC.LabelDB.Contracts;
@using ApplicationCore.Features.Orders.Shared;
@using ApplicationCore.Infrastructure.Bus;
@inherits LayoutComponentBase
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager
@inject OrderState OrderState
@inject IBus Bus
@inject IFilePicker FilePicker

<div class="page">
	<header class="w-48 h-screen fixed top-0 left-0 bg-slate-100 dark:bg-slate-700">
        <nav>
			<section>
				<div class="grid grid-cols-2 text-white">
					<div @onclick="GoBack" class="grid justify-items-center cursor-pointer p-2 ease-out duration-300 hover:bg-slate-200 dark:hover:bg-slate-600  text-gray-500 hover:text-black dark:hover:text-white">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
							<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
						</svg>
					</div>
					<div @onclick="GoForward"  class="grid justify-items-center cursor-pointer p-2 ease-out duration-300 hover:bg-slate-200 dark:hover:bg-slate-600  text-gray-500 hover:text-black dark:hover:text-white">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
							<path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
						</svg>						  
					</div>
				</div>
			</section>

			<div class="px-2 my-2 divide-slate-100">
				<hr />
			</div>

			<section class="text-gray-500">
				<NavLink href="/" Match="NavLinkMatch.All" ActiveClass="text-blue-500" class="nav-link block cursor-pointer select-none h-10 p-2 ease-out duration-300 hover:bg-slate-200 dark:hover:bg-slate-600 hover:text-black dark:hover:text-white">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2 inline-block">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V15zm0 2.25h.008v.008h-.008v-.008zm2.25-4.5h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z" />
                    </svg>
					<span class="h-6 align-middle">Home</span>
				</NavLink>
				<NavLink href="/orders/list" ActiveClass="text-blue-500" class="nav-link block cursor-pointer select-none h-10 p-2 ease-out duration-300 hover:bg-slate-200 dark:hover:bg-slate-600 hover:text-black dark:hover:text-white">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2 inline-block">
						<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
					</svg>
					<span class="h-6 align-middle">Orders</span>
				</NavLink>
				<NavLink href="/companies/list" ActiveClass="text-blue-500" class="nav-link block cursor-pointer select-none h-10 p-2 ease-out duration-300 hover:bg-slate-200 dark:hover:bg-slate-600 hover:text-black dark:hover:text-white">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2 inline-block">
						<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" />
					</svg>					  
					<span class="h-6 align-middle">Companies</span>
				</NavLink>
				<NavLink href="/workorders/list" ActiveClass="text-blue-500" class="nav-link block cursor-pointer select-none h-10 p-2 ease-out duration-300 hover:bg-slate-200 dark:hover:bg-slate-600 hover:text-black dark:hover:text-white">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2 inline-block">
						<path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
					</svg>
					<span class="h-6 align-middle">Work</span>
				</NavLink>
			</section>
				
			<div class="px-2 my-2">
				<hr />
			</div>

			<section>
				<div @onclick="LoadOrder" class="cursor-pointer select-none h-10 p-2 ease-out duration-300 hover:bg-slate-200 dark:hover:bg-slate-600  text-gray-500 hover:text-black dark:hover:text-white">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2 inline-block">
						<path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
					</svg>						  
					<span class="h-6 align-middle">Upload Order</span>
				</div>
				<div @onclick="CreateCompany" class="cursor-pointer select-none h-10 p-2 ease-out duration-300 hover:bg-slate-200 dark:hover:bg-slate-600  text-gray-500 hover:text-black dark:hover:text-white">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2 inline-block">
						<path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
					</svg>
					<span class="h-6 align-middle">Add Company</span>
				</div>
				<div @onclick="OpenBarCodeDialog" class="cursor-pointer select-none h-10 p-2 ease-out duration-300 hover:bg-slate-200 dark:hover:bg-slate-600  text-gray-500 hover:text-black dark:hover:text-white">
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2 inline-block">
						<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5" />
					</svg>
					<span class="h-6 align-middle">Barcode</span>
				</div>
			</section>

			<div onclick="toggleDarkMode()" class="text-xs w-24 mx-2 py-4 ease-in duration-300 cursor-pointer select-none absolute bottom-0 text-gray-500 hover:text-black dark:hover:text-white">
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 hidden dark:inline-block">
					<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
				</svg>
				<span class="align-middle h-4 dark:inline-block hidden">Light Mode</span>
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 dark:hidden inline-block">
					<path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
				</svg>
				<span class="align-middle h-4 inline-block dark:hidden">Dark Mode</span>
			</div>
		</nav>
    </header>
	<main class="ml-48">
        @*<article class="content px-4">*@
		<article class="container mx-auto my-12 px-0 sm:px-10">
            @Body
        </article>
    </main>
</div>

@code {

	[CascadingParameter]
	public IModalService Modal { get; set; } = default!;

	private async Task LoadOrder() {

		try {

			var sourcePrompt = Modal.Show<GetAllmoxyOrderNumberDialog>("Enter Order Number");
			var promptResult = await sourcePrompt.Result;

			if (promptResult.Cancelled) {
				return;
			}

			if (promptResult.Data is not string orderNumber || string.IsNullOrWhiteSpace(orderNumber)) {
				return;
			}

			var parameters = new ModalParameters() {
				{ "SourceType", OrderSourceType.AllmoxyXML },
				{ "Source", orderNumber.Trim() }
			};

			var options = new ModalOptions() {
				DisableBackgroundCancel = true,
				HideHeader = true
			};

			var dialog = Modal.Show<LoadingOrderDialog>("Loading Allmoxy Order", parameters, options);
			var result = await dialog.Result;

		} catch (Exception e) {

			_ = await Modal.OpenErrorDialog(new Error() {
				Title = e.Message,
				Details = e.ToString()
			});

		}

	}

	private async Task CreateCompany() {
		var options = new ModalOptions() {
			Class = "text-black dark:bg-slate-800"
		};
		var dialog = Modal.Show<CreateCompanyDialog>();
		var result = await dialog.Result;
		if (result.Confirmed) NavigationManager.NavigateTo("/companies/details", true);
	}

	private async Task OpenBarCodeDialog() {

		var dialog = Modal.Show<BarCodeScanningDialog>();
		_ = await dialog.Result;

	}

    private async Task GoBack() {
        await JSRuntime.InvokeVoidAsync("history.back");
    }

    private async Task GoForward() {
        await JSRuntime.InvokeVoidAsync("history.forward");
    }

}
