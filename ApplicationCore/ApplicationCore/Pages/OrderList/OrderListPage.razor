@page "/orders/list"
@inject IBus Bus
@inject OrderState OrderState
@inject CompanyState CompanyState
@inject NavigationManager NavigationManager
@using ApplicationCore.Features.Companies;
@using ApplicationCore.Features.Companies.Queries;
@using ApplicationCore.Features.Orders.List
@using ApplicationCore.Features.Orders.Shared.State
@using ApplicationCore.Infrastructure;
@implements IOrderListViewModel

<h1 class="text-3xl mb-2 dark:text-white">Orders</h1>

<h2 class="text-lg  mb-2 dark:text-gray-300">All orders</h2>
<OrderList ViewModel="@this"/>

@code {

    public async Task<string> GetCompanyName(Guid companyId) {

        Response<string?> response = await Bus.Send<string?>(new GetCompanyNameById.Query(companyId));

        string name = string.Empty;

        response.OnSuccess(
            companyName => name = companyName ?? string.Empty
        );

        return name;

    }

    public async Task OpenCompanyPage(Guid companyId) {
        await CompanyState.LoadCompany(companyId);
        NavigationManager.NavigateTo("/orders/details", true);
    }

}
